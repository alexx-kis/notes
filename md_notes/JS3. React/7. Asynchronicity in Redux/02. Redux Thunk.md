# Redux Thunk

## Что такое Redux Thunk?

- Redux Thunk — это middleware (посредник) для Redux, позволяющий расширять его функциональность
- Middleware в Redux перехватывают действия (actions), прежде чем их обработают редьюсеры, что позволяет выполнять дополнительные операции, например, запросы на сервер
- Redux Thunk — это готовый инструмент, позволяющий описывать такие операции в удобной форме

## Почему нужен Redux Thunk?

- Действия в Redux — это простые объекты с обязательным свойством type, которое указывает тип действия
- Они могут содержать дополнительные данные, например:

```ts
{
  type: 'INCREMENT_MISTAKE',
  payload: 1,
}
```

- Для упрощения работы с действиями мы используем функции Action Creators, которые возвращают такие объекты:

```ts
function incrementMistake() {
  return {
    type: 'INCREMENT_MISTAKE',
    payload: 1,
  };
}
```

- Этот подход удобен для описания простых действий, например, увеличения счётчика
- Но что делать, если нужно выполнить асинхронную операцию, например, запрос данных с сервера?

- Мы не можем разместить побочный эффект в действии (оно — просто объект), и редьюсер тоже не подходит, так как он должен быть чистой функцией
- Вот тут и помогает `middleware`, в частности `Redux Thunk`

## Как работает Redux Thunk?

- `Redux Thunk` позволяет в качестве действия использовать не только объекты, но и функции
- Это открывает возможность описывать асинхронные операции:

```ts
function loadQuestions() {
  return function (dispatch, getState) {
    return fetch('/questions')
      .then((response) => response.json())
      .then((questions) => {
        dispatch(setQuestions(questions));
      });
  };
}
```

В этом примере:

- Действие `loadQuestions` — это функция, которая возвращает другую функцию

### Параметры `dispatch` и `getState`

- dispatch используется для отправки нового действия
- getState позволяет получить текущее состояние хранилища.

- Внутри функции выполняется запрос к серверу (`fetch`)
- После получения данных вызывается действие setQuestions, которое обновляет хранилище

### Пример в компоненте:

```ts
dispatch(loadQuestions());
```

- Теперь `Redux Thunk` проверяет: если действие — это функция, он вызовет её, передав в неё `dispatch` и `getState`

## Как это работает под капотом?

- Код Redux Thunk удивительно прост - это всего одна функция:

```ts
function createThunkMiddleware(extraArgument) {
  return ({ dispatch, getState }) =>
    (next) =>
    (action) => {
      if (typeof action === 'function') {
        return action(dispatch, getState, extraArgument);
      }
      return next(action);
    };
}
```

- Если действие — это функция, `Redux Thunk` вызывает её
- Если нет, просто передаёт дальше в цепочке `middleware` с помощью функции ne`xt

## Резюме

- Redux Thunk — это инструмент, который позволяет:

- Диспатчить не только объекты, но и функции
- Описывать побочные эффекты, такие как запросы к серверу
- Удобно работать с асинхронными операциями, расширяя возможности Redux
