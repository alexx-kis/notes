# Настройка базы данных

- перед тем, как продолжать работать над дашбордом, нужны будут какие-то данные
- в этой главе мы настроим базу данных PostgreSQL из [Vercel's marketplace integrations](https://nextjs.org/learn/dashboard-app/setting-up-your-database#:~:text=Vercel%27s%20marketplace%20integrations)

- если вы уже знакомы с PostgreSQL и хотели бы использовать своего собственного провайдера базы данных, можно пропустить эту главу

## Создание GitHub репозитория

- чтобы начать, давайте запушим репозиторий на github
- это сделает проще настройку базы данных и деплой

## Создание аккаунта на Vercel

- посетите [vercel.com/signup](https://vercel.com/signup), чтобы создать аккаунт
- выбрать бесплатный тариф
- выбрать "продолжить с github", чтобы связать аккаунты

## Подключение и деплой проекта

- затем произойдёт перенаправление на страницу, где можно выбрать и импортировать github-репозиторий, который был создан

- благодаря связыванию github-репозитория, когда-либо внося изменения в ветку main, Vercel будет автоматически пересобирать приложение без необходимости конфигурирования

- при открытии of pull requests вы так же будете получать мгновенные URL-адреса для предварительного просмотра, которые позволят выявлять ошибки на ранних этапах и делиться просмотром проекта

## Создание базы данных Postgres

- чтобы настроить базу данных, кликнуть Continue to Dashboard и выбрать вкладку Storage из панели настроек проекта
- выбрать Create Database
- в зависимости от того, когда аккаунт Vercel был создан, можно будет увидеть следующие опции: Postgres (Powered by Neon), Neon, or Supabase
- выбрать предпочтительного провайдера и нажать Continue (Postgres)
- создать по инструкции
- после подсоединения перейти во вкладку `.env.local`, нажать `Show secret` и `Copy Snippet`
- убедиться, что секреты раскрыты перед копированием
- перейти в редактор кода и переименовать файл `.env.example` в `.env`
- в этот файл вставить скопированное

- ! важно: перейти в файл `.gitignore` и убедиться, что `.env` есть в списке игнорируемых файлов, чтобы предотвратить раскрытие секретов базы данных при синхронизации с github

- наконец, запустить команду `pnpm i @vercel/postgres`, чтобы установить [Vercel Postgres SDK](https://vercel.com/docs/storage/vercel-postgres/sdk)

## Наполнение базы данных

- теперь, когда база данных создана, наполним её какими-то начальными данными

- в папке `/app` есть папка `seed`
- раскомментируем этот файл и удалим блок `Response.json()`

- эта папка содержит `Next.js Route Handler`, который называется `route.ts`, он будет использован для наполнения базы данных

- это создаёт конечную точку на стороне сервера, к которой можно получить доступ в браузере, чтобы начать наполнение базы данных

- не переживайте, если не понимаете всё, что делает этот код, но для общего представления: этот скрипт использует SQL для создания таблиц и данных из файла `placeholder-data.ts` для их заполнения после создания

- убедимся, что локальный сервер разработки запущен с помощью `pnpm run dev` и перейдём в `localhost:3000/seed` в браузере
- после завершения будет сообщение `Database seeded successfully` в браузере
- после завершения можно удалить этот файл

## Выполнение запросов

- давайте выполним запрос, чтобы убедиться, что всё работает, как ожидалось
- мы будем использовать другой Router Handler, `app/query/route.ts`, для запроса к базе данных
- внутри этого файла есть функция `listInvoices()`, которая содержит следующий SQL запрос

```ts
SELECT invoices.amount, customers.name
FROM invoices
JOIN customers ON invoices.customer_id = customers.id
WHERE invoices.amount = 666;
```

- раскомментируем этот файл, удалим блок `Response.json()` и перейдём в браузере на `localhost:3000/query`
- мы должны увидеть, что инвойс `amount` и `name` возвращены