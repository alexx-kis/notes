# 5.1.6. Добавление логики обновления задачи

- в BoardPresenter раз появился обработчик handleTaskChange(), нам его надо как-то передавать, где он будет вызываться
- он должен вызываться в TaskPresenter
- поэтому при создании очередного экземпляра TaskPresenter будем передавать ссылку на этот обработчик
- то есть заводим свойство onDataChange и будем сюда передавать ссылку на обработчик, чтобы мы смогли им воспользоваться, когда данные обновятся

- при этом в taskPresenter расширяем конструктор - передаём onDataChange, и соответственно через это свойство будем передавать обработчик

```js
export default class TaskPresenter {
  #taskListContainer = null;
  #handleDataChange = null;

  //...

  constructor({ taskListContainer, onDataChange }) {
    this.#taskListContainer = taskListContainer;
    this.#handleDataChange = onDataChange;
  }
}
```

- как мы потренируемся обновлять задачи - чтобы обновить задачу, нужно сделать какое-то действие, которое будет обновляться

- предусмотрим для этого действия для кликов по favorites и archive

- в модуле task-view, раз нужно сделать действия для этих кнопок, нужно расшить функциональность представлений

- для этого добавим в передачу через конструктор дополнительных обработчиков (onFavoriteClick, onArchiveClick) - какие действия должны произойти по кликам на кнопки

- передаём обработчики через конструктор и сохраняем в свойства (handleFavoriteClick, handleArchiveClick)

- находим соответствующие элементы интерфейса - DOM-элементы, выполняем подписку на события клика, чтобы потом можно было с ними взаимодействовать

```js
  constructor({task, onEditClick, onFavoriteClick, onArchiveClick}) {
    super();
    this.#task = task;
    this.#handleEditClick = onEditClick;
    this.#handleFavoriteClick = onFavoriteClick;
    this.#handleArchiveClick = onArchiveClick;

    this.element.querySelector('.card__btn--edit')
      .addEventListener('click', this.#editClickHandler);
    this.element.querySelector('.card__btn--favorites')
      .addEventListener('click', this.#favoriteClickHandler);
    this.element.querySelector('.card__btn--archive')
      .addEventListener('click', this.#archiveClickHandler);
  }
```

- и заводим два обработчика, где и будем вызывать те коллбэки, которые приходят снаружи

```js
  #favoriteClickHandler = (evt) => {
    evt.preventDefault();
    this.#handleFavoriteClick();
  };

  #archiveClickHandler = (evt) => {
    evt.preventDefault();
    this.#handleArchiveClick();
  };
```

- то же самое делаем для TaskEditView, только здесь уже нужно передавать данные задачи в обработчик formSubmitHandler

```js
  #formSubmitHandler = (evt) => {
    evt.preventDefault();
    this.#handleFormSubmit(this.#task);
  };
```

- что у нас получилось, что мы из BoardPresenter передали коллбэк handleTaskChange (где мы написали логику, которая должна происходить при обновлении задачи), и мы расширили представления

- в taskPresenter нужно при создании представлений тоже всё это передать, то есть передать сами обработчики, где у нас будет непосредственно вызываться код обновления, то есть код реакции на нажатие по кнопкам

```js
this.#taskComponent = new TaskView({
  task: this.#task,
  onEditClick: this.#handleEditClick,
  onFavoriteClick: this.#handleFavoriteClick,
  onArchiveClick: this.#handleArchiveClick,
});
this.#taskEditComponent = new TaskEditView({
  task: this.#task,
  onFormSubmit: this.#handleFormSubmit,
});
```

- в этом коде мы будем вызывать this.#handleDataChange - то что приходит из BoardPresenter, аргументом ей передаём обновлённые данные 

- пока мы при клике на favorite копируем все данные из задачи, которые пришли изначально и меняем только значение флага isFavorite

- то же самое для флага isArchive, когда кликаем по кнопке archive

- для handleFormSubmit мы просто передаём информацию по задаче

```js
  #handleFavoriteClick = () => {
    this.#handleDataChange({...this.#task, isFavorite: !this.#task.isFavorite});
  };

  #handleArchiveClick = () => {
    this.#handleDataChange({...this.#task, isArchive: !this.#task.isArchive});
  };
    #handleFormSubmit = (task) => {
    this.#handleDataChange(task);
    this.#replaceFormToCard();
  };
```

58:10