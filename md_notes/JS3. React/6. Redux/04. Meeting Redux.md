# Введение в Redux

- Redux — это библиотека для управления глобальным состоянием приложения, основанная на архитектурном паттерне Flux
- Она используется для предсказуемого управления состоянием, особенно в сложных приложениях с большим количеством взаимосвязанных компонентов

## Почему нужно глобальное состояние?

- Состояние — это данные, которые описывают текущее состояние интерфейса приложения:

  - Раскрыт ли выпадающий список
  - Количество товара в корзине
  - Активные промокоды и доступные способы доставки

- Глобальное состояние необходимо, когда данные используются несколькими компонентами одновременно. Например:

- В интернет-магазине выбранный способ доставки зависит от товара, его количества и применённых скидок
- Эти данные должны быть доступны и компоненту корзины, и компоненту выбора доставки, и баннерам

## Проблемы управления глобальным состоянием без Redux

- Громоздкий корневой компонент: Все данные приходится хранить на верхнем уровне приложения
- Передача данных через props: Данные нужно передавать через всю иерархию компонентов, даже если они нужны только на нижних уровнях
- Конфликты: Изменение данных в одном месте может неожиданно сломать другую часть приложения

## Flux-архитектура: основа Redux

- Redux реализует Flux, архитектурный паттерн с однонаправленным потоком данных:

  - Глобальное состояние хранится в Store.
  - Представление (компоненты) получают данные из Store и формируют Action, чтобы изменить их.
  - Изменения состояния происходят через чистую функцию Reducer.

## Поток данных во Flux:

```
[Action] → [Dispatcher] → [Store] → [View]
   ↑                                  |
   |----------------------------------|
```

## Основные концепции Redux

- Redux добавляет структуру в управление состоянием, вводя следующие ключевые элементы:

1. Store (Хранилище)

- `Store` — это объект, который содержит глобальное состояние приложения.

- Взаимодействие с `Store` происходит через три метода:
  - `getState()` — получить текущее состояние
  - `dispatch(action)` — отправить действие для изменения состояния
  - `subscribe(listener)` — подписаться на изменения состояния

### Пример:

```javascript
import { createStore } from 'redux';

const initialState = { codes: [] };

const reducer = (state = initialState, action) => {
  if (action.type === 'APPLY_CODE') {
    return { ...state, codes: [...state.codes, action.payload] };
  }
  return state;
};

const store = createStore(reducer);

console.log(store.getState()); // { codes: [] }
```

2. Action (Действие)

- `Action` — это объект, описывающий, что должно произойти
- Обязательное поле — `type`, которое определяет тип действия
- Также можно добавить дополнительные данные в `payload`.

### Пример:

```javascript
const applyCodeAction = {
  type: 'APPLY_CODE',
  payload: '100_user',
};
```

3. Dispatch (Диспетчер)

- Метод `dispatch()` отправляет `Action` в `Store`, чтобы инициировать изменение состояния.

Пример:

```javascript
store.dispatch(applyCodeAction);
console.log(store.getState()); // { codes: ['100_user'] }
```

4. Reducer (Редьюсер)
   `Reducer` — это чистая функция, которая описывает, как изменяется состояние в ответ на Action.

### Пример:

```javascript
function reducer(state, action) {
  switch (action.type) {
    case 'APPLY_CODE':
      return { ...state, codes: [...state.codes, action.payload] };
    default:
      return state;
  }
}
```

## Использование Redux с React

- Для удобной интеграции Redux в React используют библиотеку `react-redux`, которая предоставляет следующие инструменты:

1. Provider

- Компонент `<Provider>` оборачивает всё приложение и передаёт `Store` дочерним компонентам

### Пример:

```jsx
import ReactDOM from 'react-dom';
import { Provider } from 'react-redux';
import App from './App';
import { store } from './store';

ReactDOM.render(
  <Provider store={store}>
    <App />
  </Provider>,
  document.getElementById('root')
);
```

2. useSelector

- Хук `useSelector` позволяет извлекать данные из Store для использования в компонентах.

### Пример:

```jsx
import { useSelector } from 'react-redux';

function CodesList() {
  const codes = useSelector((state) => state.codes);

  return (
    <ul>
      {codes.map((code) => (
        <li key={code}>{code}</li>
      ))}
    </ul>
  );
}
```

3. useDispatch

- Хук `useDispatch` позволяет диспатчить Action из компонентов

### Пример:

```jsx
import { useDispatch } from 'react-redux';

function AddCodeButton() {
  const dispatch = useDispatch();

  return (
    <button onClick={() => dispatch({ type: 'APPLY_CODE', payload: 'new_code' })}>
      Add Code
    </button>
  );
}
```

## Когда использовать Redux?

- Redux полезен, если:

  - Требуется синхронизировать данные между многими компонентами
  - Часто меняется глобальное состояние
  - Нужен контроль над состоянием во времени (например, для отладки)
  - Необходимы промежуточные обработки через middleware (например, для запросов на сервер)
  - Если приложение небольшое, предпочтительнее использовать хуки React (useState, useReducer) или контекст

## Резюме

- Redux реализует принципы Flux: централизованное хранилище, однонаправленный поток данных, чистые редьюсеры
- Основные элементы: store, action, dispatch, reducer
- Для React-приложений рекомендуется использовать react-redux, который предоставляет хуки useSelector и useDispatch
- Redux удобен для крупных приложений, где глобальное состояние сложно и часто изменяется
